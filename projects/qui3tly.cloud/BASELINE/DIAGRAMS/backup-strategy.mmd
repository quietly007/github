graph TB
    subgraph Sources["üíæ Backup Sources"]
        direction TB
        
        subgraph MasterData["Master Server Data"]
            DockerVol1[Docker Volumes<br/>25 containers<br/>~30GB]
            PrometheusData[Prometheus TSDB<br/>15.2GB<br/>15 days metrics]
            GrafanaData[Grafana<br/>Dashboards<br/>Datasources<br/>Users]
            HeadscaleDB[Headscale DB<br/>SQLite<br/>Node info]
            ConfigsMaster[Configs<br/>‚Ä¢ Traefik<br/>‚Ä¢ Authelia<br/>‚Ä¢ Prometheus<br/>‚Ä¢ All services]
        end
        
        subgraph LadyData["Lady Server Data"]
            DockerVol2[Docker Volumes<br/>39 containers<br/>~50GB]
            MailcowData[Mailcow Data<br/>‚Ä¢ Mail store: 73GB<br/>‚Ä¢ MySQL DB<br/>‚Ä¢ Redis data<br/>‚Ä¢ Configs]
            NextcloudData[Nextcloud<br/>‚Ä¢ User files: 128GB<br/>‚Ä¢ Database<br/>‚Ä¢ Config]
            OdooData[Odoo<br/>‚Ä¢ Database<br/>‚Ä¢ Attachments]
            ConfigsLady[Configs<br/>‚Ä¢ Mailcow<br/>‚Ä¢ Business apps<br/>‚Ä¢ All services]
        end
        
        subgraph Databases["Database Backups"]
            MySQL[MySQL Dumps<br/>‚Ä¢ Mailcow DB<br/>‚Ä¢ MariaDB users]
            Postgres[PostgreSQL Dumps<br/>‚Ä¢ Nextcloud DB<br/>‚Ä¢ Odoo DB<br/>‚Ä¢ Authelia DB]
            Redis[Redis RDB<br/>‚Ä¢ Snapshots<br/>‚Ä¢ AOF logs]
        end
        
        subgraph Code["Code & Scripts"]
            Automation[Automation Scripts<br/>29 scripts<br/>~/.copilot/scripts/]
            Ansible[Ansible Playbooks<br/>Infrastructure as Code]
            CustomCode[Custom Apps<br/>‚Ä¢ Admin panel<br/>‚Ä¢ Scripts]
        end
    end

    subgraph Schedule["‚è∞ Backup Schedule"]
        direction LR
        
        Daily["<b>DAILY</b> (3am)<br/>‚Ä¢ Docker volumes<br/>‚Ä¢ Databases<br/>‚Ä¢ Headscale DB<br/>‚Ä¢ Prometheus snapshot"]
        
        Weekly["<b>WEEKLY</b> (2am Sunday)<br/>‚Ä¢ Full system backup<br/>‚Ä¢ Configuration audit<br/>‚Ä¢ Security scan"]
        
        Monthly["<b>MONTHLY</b> (3am 1st)<br/>‚Ä¢ Complete snapshot<br/>‚Ä¢ Off-site sync<br/>‚Ä¢ Archive cold storage"]
        
        OnChange["<b>ON CHANGE</b><br/>‚Ä¢ Git commit configs<br/>‚Ä¢ Git push automation<br/>‚Ä¢ Instant sync"]
    end

    subgraph Scripts["ü§ñ Backup Scripts"]
        direction TB
        
        Cron["Cron Job<br/>0 3 * * *<br/>/root/.copilot/scripts/docker_backup.sh"]
        
        ScriptList["<b>Backup Scripts:</b><br/>‚Ä¢ docker_backup.sh (312 lines)<br/>‚Ä¢ prometheus_snapshot.sh (91 lines)<br/>‚Ä¢ grafana_backup.sh (103 lines)<br/>‚Ä¢ headscale_backup.sh (87 lines)<br/>‚Ä¢ mysql_backup.sh (167 lines)<br/>‚Ä¢ postgres_backup.sh (154 lines)<br/>‚Ä¢ redis_snapshot.sh (82 lines)<br/>‚Ä¢ config_sync.sh (198 lines)<br/>‚Ä¢ mailcow_backup.sh (Mailcow native)"]
    end

    subgraph Storage["üíø Storage Locations"]
        direction TB
        
        subgraph Local["Local Storage"]
            BackupDir["/backup/<br/>45GB total<br/>Master + Lady"]
            
            subgraph Retention["Retention Policies"]
                R1[Daily: 30 days]
                R2[Weekly: 12 weeks]
                R3[Monthly: 12 months]
            end
        end
        
        subgraph Remote["Remote Storage"]
            Git["GitHub Private Repo<br/>‚Ä¢ Configs<br/>‚Ä¢ Scripts<br/>‚Ä¢ IaC<br/>Infinite retention"]
        end
        
        subgraph Future["üéØ Future (Phase 06)"]
            OffSite[Off-site Backup<br/>‚Ä¢ Second datacenter<br/>‚Ä¢ Cloud storage<br/>‚Ä¢ Encrypted]
        end
    end

    subgraph Process["üîÑ Backup Process"]
        direction LR
        
        P1[1. Pre-backup checks<br/>‚Ä¢ Disk space<br/>‚Ä¢ Service health]
        P2[2. Container pause<br/>‚Ä¢ Optional<br/>‚Ä¢ For consistency]
        P3[3. Data backup<br/>‚Ä¢ Volumes<br/>‚Ä¢ Databases<br/>‚Ä¢ Configs]
        P4[4. Compression<br/>‚Ä¢ gzip -9<br/>‚Ä¢ tar archives]
        P5[5. Verification<br/>‚Ä¢ Checksum<br/>‚Ä¢ List contents]
        P6[6. Cleanup<br/>‚Ä¢ Remove old<br/>‚Ä¢ Apply retention]
        P7[7. Notification<br/>‚Ä¢ Gotify alert<br/>‚Ä¢ Log entry]
        
        P1 --> P2 --> P3 --> P4 --> P5 --> P6 --> P7
    end

    subgraph Testing["üß™ Restore Testing"]
        LastTest["<b>Last Restore Test:</b><br/>January 28, 2026<br/>‚úÖ Successful<br/><br/>RTO: 4 hours<br/>RPO: 24 hours"]
        
        NextTest["<b>Next Test:</b><br/>Phase 06<br/>‚Ä¢ Full DR drill<br/>‚Ä¢ Multi-datacenter<br/>‚Ä¢ Documented runbook"]
    end

    Sources --> Schedule
    Schedule --> Scripts
    Scripts --> Process
    Process --> Storage
    Storage -.->|Restore from| Testing

    MasterData --> Daily
    LadyData --> Daily
    Databases --> Daily
    Code --> OnChange
    
    Daily --> Cron
    Weekly --> Cron
    Monthly --> Cron
    OnChange --> Git
    
    Cron --> ScriptList
    ScriptList --> BackupDir
    Code --> Git

    classDef daily fill:#00d4aa,stroke:#fff,stroke-width:2px,color:#000
    classDef weekly fill:#326ce5,stroke:#fff,stroke-width:2px,color:#fff
    classDef monthly fill:#f77f00,stroke:#fff,stroke-width:2px,color:#fff
    classDef storage fill:#d62828,stroke:#fff,stroke-width:2px,color:#fff

    class Daily,Cron daily
    class Weekly weekly
    class Monthly monthly
    class Storage,BackupDir,Git storage
