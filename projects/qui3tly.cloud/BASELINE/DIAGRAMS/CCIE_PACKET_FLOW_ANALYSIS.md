# CCIE Packet Flow Analysis â€” Interface-Level Tracing

> **Author**: qui3tly (One of the first CCIE in the region)  
> **Verified**: 2026-02-16 (ALL data from LIVE system)  
> **Standard**: Cisco CCIE-level documentation â€” EVERY interface specified, EVERY IP documented  
> **Scope**: 6 real-world packet trace scenarios

---

## SCENARIO 1: External User Accesses Grafana (HTTPS)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Internet User â†’ grafana.quietly.its.me (HTTPS)
    Path: Internet â†’ eth0 â†’ Traefik â†’ Authelia â†’ Grafana container
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[External User]                                   [MASTER SERVER â€” 213.136.68.108]
Browser: Chrome                                   OS: Debian 12
     â”‚                                            Role: Control Plane
     â”‚
     â”‚  STEP 1: DNS RESOLUTION
     â”‚  Query: grafana.quietly.its.me â†’ Cloudflare (1.1.1.1)
     â”‚  Response: 213.136.68.108 (A record â€” public IP)
     â”‚
     â”‚  STEP 2: TCP 3-Way Handshake
     â”‚  SYN: src=Client:ephemeral â†’ dst=213.136.68.108:443 (TCP)
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                            â”‚
     â”‚                                            â–¼
     â”‚                              â”Œâ”€ â— eth0 (Physical WAN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  IP:  213.136.68.108/24                â”‚
     â”‚                              â”‚  MAC: 00:50:56:5f:34:33                â”‚
     â”‚                              â”‚  MTU: 1500                             â”‚
     â”‚                              â”‚  IN:  SYN packet received              â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ NETFILTER: nat PREROUTING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  Rule: DOCKER chain (ADDRTYPE LOCAL)   â”‚
     â”‚                              â”‚  Match: dst 213.136.68.108:443/tcp     â”‚
     â”‚                              â”‚  Action: DNAT â†’ 172.30.0.2:443        â”‚
     â”‚                              â”‚  (172.30.0.2 = Traefik on monitoring)  â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ NETFILTER: filter FORWARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  Chain: DOCKER-USER â†’ RETURN           â”‚
     â”‚                              â”‚  Chain: DOCKER-FORWARD â†’ ACCEPT        â”‚
     â”‚                              â”‚  Packet forwarded: eth0 â†’ br-0341e55be098
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ â— br-0341e55be098 "monitoring" â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  IP:  172.30.0.1/24                    â”‚
     â”‚                              â”‚  MAC: 1a:fa:54:48:5f:8a                â”‚
     â”‚                              â”‚  MTU: 1500                             â”‚
     â”‚                              â”‚  Delivers to: 172.30.0.6 (Traefik)    â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ TRAEFIK (172.30.0.6 + 172.18.0.18) â”€â”€â”
     â”‚                              â”‚  TLS termination: Let's Encrypt        â”‚
     â”‚                              â”‚  SNI: grafana.quietly.its.me           â”‚
     â”‚                              â”‚  Host header match â†’ route "grafana"   â”‚
     â”‚                              â”‚                                        â”‚
     â”‚                              â”‚  Middleware chain:                      â”‚
     â”‚                              â”‚  1. CrowdSec bouncer check             â”‚
     â”‚                              â”‚     â†’ bouncer-traefik (172.18.0.8)     â”‚
     â”‚                              â”‚     â†’ IP not in blocklist â†’ PASS       â”‚
     â”‚                              â”‚  2. Authelia forwardAuth               â”‚
     â”‚                              â”‚     â†’ authelia (172.18.0.14)           â”‚
     â”‚                              â”‚     â†’ No valid session cookie          â”‚
     â”‚                              â”‚     â†’ REDIRECT to auth.quietly.its.me  â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚  STEP 3: HTTP 302 Redirect                  â”‚
     â”‚  â—€â”€â”€â”€â”€â”€â”€ Location: https://auth.quietly.its.me/?rd=https://grafana...
     â”‚
     â”‚  STEP 4: User authenticates with Authelia
     â”‚  POST: https://auth.quietly.its.me/api/firstfactor
     â”‚  Body: username=qui3tly&password=*****
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                            â”‚
     â”‚                                            â–¼
     â”‚                              â”Œâ”€ AUTHELIA (172.18.0.14) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  Check: credentials valid              â”‚
     â”‚                              â”‚  Factor 1: âœ“ Password OK              â”‚
     â”‚                              â”‚  Factor 2: TOTP required              â”‚
     â”‚                              â”‚  â†’ Prompt for 6-digit code            â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚  STEP 5: TOTP 2FA submission                â”‚
     â”‚  POST: /api/secondfactor/totp               â”‚
     â”‚  Body: token=482917                         â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                            â”‚
     â”‚                              â”Œâ”€ AUTHELIA SESSION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  TOTP: âœ“ Valid                         â”‚
     â”‚                              â”‚  Session: 12h expiry, 1h inactivity   â”‚
     â”‚                              â”‚  Cookie: Set-Cookie: authelia_session  â”‚
     â”‚                              â”‚  Redirect: â†’ grafana.quietly.its.me   â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚  STEP 6: Grafana access with valid session  â”‚
     â”‚  GET: https://grafana.quietly.its.me/       â”‚
     â”‚  Cookie: authelia_session=<token>            â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                            â”‚
     â”‚                              â”Œâ”€ TRAEFIK â†’ GRAFANA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  ForwardAuth: Authelia returns 200 OK  â”‚
     â”‚                              â”‚  Route: â†’ grafana (172.18.0.21)        â”‚
     â”‚                              â”‚  OR via monitoring: 172.30.0.11        â”‚
     â”‚                              â”‚  Port: 3000 (Grafana internal)         â”‚
     â”‚                              â”‚  Memory limit: 1 GiB                   â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚  STEP 7: Grafana dashboard response         â”‚
     â”‚  â—€â”€â”€â”€â”€â”€â”€ 200 OK + dashboard HTML/JS         â”‚
     â”‚                                             â”‚


    TOTAL PATH: Client â†’ eth0 â†’ DNAT â†’ FORWARD â†’ br-monitoring â†’
                Traefik â†’ CrowdSec â†’ Authelia â†’ Grafana â†’ response
    INTERFACES TRAVERSED: eth0 â†’ br-0341e55be098 (monitoring bridge)
    IPs INVOLVED: 213.136.68.108, 172.30.0.2, 172.30.0.6, 172.18.0.8,
                  172.18.0.14, 172.18.0.21
    ENCRYPTION: TLS 1.3 (Internet) â†’ plaintext (container-to-container)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SCENARIO 2: Home Device Resolves DNS via WireGuard â†’ Pi-hole

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Home LAN â†’ DNS Query â†’ WireGuard â†’ Pi-hole â†’ cloudflared
    Path: Mac (192.168.99.x) â†’ EdgeRouter â†’ WG tunnel â†’ Pi-hole container
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Mac Mini]               [EdgeRouter X]              [MASTER SERVER]
192.168.99.x             192.168.99.1                213.136.68.108
100.64.0.3 (Tailscale)   10.10.0.2 (WG)              10.10.0.1 (WG)
     â”‚                        â”‚                           â”‚
     â”‚  1. DNS Query           â”‚                           â”‚
     â”‚  src: 192.168.99.x:rand â”‚                           â”‚
     â”‚  dst: 10.10.0.1:53      â”‚                           â”‚
     â”‚  OUT: â— en0 (LAN)       â”‚                           â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                           â”‚
     â”‚                         â”‚                           â”‚
     â”‚                   â”Œâ”€ â— eth1.0 (LAN Gateway) â”€â”€â”€â”€â”   â”‚
     â”‚                   â”‚  IP:  192.168.99.1/24        â”‚   â”‚
     â”‚                   â”‚  IN:  DNS query received     â”‚   â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                  â”‚                   â”‚
     â”‚                                  â–¼                   â”‚
     â”‚                   â”Œâ”€ Routing Decision â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚                   â”‚  dst: 10.10.0.1              â”‚   â”‚
     â”‚                   â”‚  Match: 10.10.0.0/30 via wg0 â”‚   â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                  â”‚                   â”‚
     â”‚                   â”Œâ”€ â— wg0 (WireGuard) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚                   â”‚  IP:  10.10.0.2/30           â”‚   â”‚
     â”‚                   â”‚  Peer: 213.136.68.108:51820  â”‚   â”‚
     â”‚                   â”‚  MTU:  1420                   â”‚   â”‚
     â”‚                   â”‚  OUT: Encrypted UDP           â”‚   â”‚
     â”‚                   â”‚  Encap: WireGuard             â”‚   â”‚
     â”‚                   â”‚  Encryption: ChaCha20         â”‚   â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                  â”‚                   â”‚
     â”‚                   â”Œâ”€ â— eth0 (WAN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚                   â”‚  IP:  62.4.55.119 (dynamic)  â”‚   â”‚
     â”‚                   â”‚  Outer packet:                â”‚   â”‚
     â”‚                   â”‚  src: 62.4.55.119:38340       â”‚   â”‚
     â”‚                   â”‚  dst: 213.136.68.108:51820    â”‚   â”‚
     â”‚                   â”‚  Proto: UDP (WireGuard)       â”‚   â”‚
     â”‚                   â”‚  OUT: â†’ Internet              â”‚   â”‚
     â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                  â”‚                   â”‚
     â”‚                    â•â• INTERNET â•â•                    â”‚
     â”‚                                  â”‚                   â”‚
     â”‚                                                      â”‚
     â”‚                                            â”Œâ”€ â— eth0 (WAN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                            â”‚  IP:  213.136.68.108/24       â”‚
     â”‚                                            â”‚  MAC: 00:50:56:5f:34:33       â”‚
     â”‚                                            â”‚  IN:  UDP 51820 received      â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                            â”Œâ”€ â— wg0 (WireGuard) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                            â”‚  IP:  10.10.0.1/30            â”‚
     â”‚                                            â”‚  Decrypted inner packet:      â”‚
     â”‚                                            â”‚  src: 192.168.99.x:rand       â”‚
     â”‚                                            â”‚  dst: 10.10.0.1:53/udp        â”‚
     â”‚                                            â”‚  Allowed: 192.168.99.0/24 âœ“   â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                            â”Œâ”€ NETFILTER: nat PREROUTING â”€â”€â”
     â”‚                                            â”‚  Match: 10.10.0.1:53/udp     â”‚
     â”‚                                            â”‚  DNAT â†’ 172.70.9.3:53        â”‚
     â”‚                                            â”‚  (Pi-hole on pihole_internal) â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                            â”Œâ”€ â— br-ca56054321aa â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                            â”‚  "pihole_internal"            â”‚
     â”‚                                            â”‚  IP: 172.70.9.1/29           â”‚
     â”‚                                            â”‚  MAC: 0a:15:e6:9c:b1:1c      â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                            â”Œâ”€ Pi-hole (172.70.9.3) â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                            â”‚  Check: blocked domain list   â”‚
     â”‚                                            â”‚  NOT blocked â†’ forward to     â”‚
     â”‚                                            â”‚  upstream: cloudflared        â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚                                                           â–¼
     â”‚                                            â”Œâ”€ cloudflared (172.70.9.2) â”€â”€â”€â”
     â”‚                                            â”‚  DNS-over-HTTPS to 1.1.1.1   â”‚
     â”‚                                            â”‚  via â— eth0 (MASQUERADE)     â”‚
     â”‚                                            â”‚  Response: A record IP        â”‚
     â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                           â”‚
     â”‚  DNS Response (reverse path)                              â”‚
     â”‚  â—€â”€â”€â”€â”€â”€â”€ cloudflared â†’ Pi-hole â†’ wg0 â†’ Internet â†’ EdgeRouter â†’ LAN â†’ Mac
     â”‚

    INTERFACES TRAVERSED (forward):
      Mac en0 â†’ ER eth1.0 â†’ ER wg0 â†’ ER eth0 â†’ [Internet] â†’
      Master eth0 â†’ Master wg0 â†’ DNAT â†’ br-ca56054321aa â†’
      pihole (172.70.9.3) â†’ cloudflared (172.70.9.2) â†’
      br-ca56054321aa â†’ MASQ â†’ eth0 â†’ 1.1.1.1

    ENCRYPTION:
      Mac â†’ ER:         None (trusted LAN, 192.168.99.0/24)
      ER â†’ Master:      ChaCha20-Poly1305 (WireGuard tunnel)
      cloudflared â†’ CF: TLS 1.3 (DNS-over-HTTPS)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SCENARIO 3: Prometheus Scrapes Lady's node-exporter (Tailscale Mesh)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Prometheus â†’ Tailscale mesh â†’ Lady node-exporter
    Path: Master (100.64.0.1) â†’ tailscale0 â†’ Lady (100.64.0.2) â†’ container
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[MASTER]                                          [LADY]
prometheus (172.30.0.2)                            node-exporter (172.19.0.x)
     â”‚                                                  â”‚
     â”‚  1. Scrape config triggers (every 15s)           â”‚
     â”‚  Target: 100.64.0.2:9100/metrics                 â”‚
     â”‚  src: prometheus container â†’ Docker gateway       â”‚
     â”‚                                                   â”‚
     â–¼                                                   â”‚
â”Œâ”€ â— br-0341e55be098 "monitoring" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  Gateway: 172.30.0.1/24                        â”‚       â”‚
â”‚  Container src: 172.30.0.2 (prometheus)        â”‚       â”‚
â”‚  Destination: 100.64.0.2:9100 (not local)      â”‚       â”‚
â”‚  â†’ Forward to host routing stack               â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                     â”‚                                    â”‚
                     â–¼                                    â”‚
â”Œâ”€ Host Routing Decision â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  dst: 100.64.0.2                               â”‚        â”‚
â”‚  Match: 100.64.0.0/10 â†’ â— tailscale0          â”‚        â”‚
â”‚  Next-hop: 100.64.0.2 (direct peer)           â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                     â”‚                                    â”‚
                     â–¼                                    â”‚
â”Œâ”€ â— tailscale0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  IP:  100.64.0.1/32                            â”‚        â”‚
â”‚  MTU: 1280                                     â”‚        â”‚
â”‚  Peer: 100.64.0.2 (Lady) â€” DIRECT connection  â”‚        â”‚
â”‚  Outer: UDP 41641 to 207.180.251.111:41641     â”‚        â”‚
â”‚  Encryption: ChaCha20-Poly1305                 â”‚        â”‚
â”‚  OUT: via â— eth0 (213.136.68.108)              â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
                     â”‚                                    â”‚
               â•â• INTERNET (encrypted WireGuard) â•â•      â”‚
                     â”‚                                    â”‚
                     â”‚                                    â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•Œâ”€â”€â”€â”€â”€â–¶
                                                          â”‚
                                            â”Œâ”€ â— eth0 (Lady WAN) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚  IP:  207.180.251.111/18        â”‚
                                            â”‚  MAC: 00:50:56:5f:34:39        â”‚
                                            â”‚  IN:  UDP 41641 received        â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€ â— tailscale0 (Lady) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚  IP:  100.64.0.2/32             â”‚
                                            â”‚  MTU: 1280                      â”‚
                                            â”‚  Decrypted inner packet:        â”‚
                                            â”‚  src: 100.64.0.1:rand           â”‚
                                            â”‚  dst: 100.64.0.2:9100/tcp       â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€ UFW check â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                            â”‚  src: 100.64.0.0/10 â†’ ALLOW   â”‚
                                            â”‚  (Rule: ALL from Tailscale)    â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                                            â”Œâ”€ node-exporter container â”€â”€â”€â”€â”€â”€â”
                                            â”‚  Listening: 0.0.0.0:9100       â”‚
                                            â”‚  Response: Prometheus metrics   â”‚
                                            â”‚  (cpu, mem, disk, network)      â”‚
                                            â”‚  Content-Type: text/plain       â”‚
                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â”‚
     â”‚  Metrics response (reverse path)                    â”‚
     â”‚  â—€â”€â”€â”€â”€â”€â”€ node-exporter â†’ tailscale0 â†’ Internet     â”‚
     â”‚          â†’ Master tailscale0 â†’ monitoring bridge    â”‚
     â”‚          â†’ prometheus container                     â”‚

    ENCRYPTION: End-to-end ChaCha20-Poly1305 (Tailscale mesh)
    SCRAPE INTERVAL: 15 seconds
    DATA: ~500-2000 metric lines per scrape

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SCENARIO 4: External Email Delivery (SMTP â†’ Mailcow on Lady)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Sending MTA â†’ Lady SMTP â†’ Postfix â†’ Rspamd â†’ Dovecot
    Path: Internet â†’ eth0:25 â†’ Mailcow stack (18 containers)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Sending MTA]                                     [LADY SERVER â€” 207.180.251.111]
mail.example.com                                  quietly.online
     â”‚                                                  â”‚
     â”‚  1. MX lookup: quietly.online                    â”‚
     â”‚     â†’ mail.quietly.online (priority 10)          â”‚
     â”‚     â†’ A: 207.180.251.111                         â”‚
     â”‚                                                   â”‚
     â”‚  2. TCP connection to port 25                     â”‚
     â”‚  src: sender:rand â†’ dst: 207.180.251.111:25      â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                                   â”‚
     â”‚                              â”Œâ”€ â— eth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  IP:  207.180.251.111/18              â”‚
     â”‚                              â”‚  MAC: 00:50:56:5f:34:39               â”‚
     â”‚                              â”‚  IN:  TCP SYN on port 25              â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ UFW CHECK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  Rule: 25/tcp ALLOW from ANY          â”‚
     â”‚                              â”‚  Result: ACCEPT                       â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ Docker DNAT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  dst 207.180.251.111:25               â”‚
     â”‚                              â”‚  â†’ 172.28.1.x:25 (postfix-mailcow)   â”‚
     â”‚                              â”‚  Network: br-mailcow (172.28.1.0/24) â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚  3. SMTP conversation                       â”‚
     â”‚  EHLO mail.example.com                      â”‚
     â”‚  MAIL FROM: <user@example.com>              â”‚
     â”‚  RCPT TO: <qui3tly@quietly.online>          â”‚
     â”‚  DATA: <email body>                         â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                                             â”‚
     â”‚                              â”Œâ”€ POSTFIX (172.28.1.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  MTA: Receives SMTP                    â”‚
     â”‚                              â”‚  Memory: 78.5 MiB                      â”‚
     â”‚                              â”‚  TLS: STARTTLS offered                 â”‚
     â”‚                              â”‚                                        â”‚
     â”‚                              â”‚  â†’ Forward to Rspamd for scanning      â”‚
     â”‚                              â”‚    via milter protocol                  â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ RSPAMD (172.28.1.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  Spam filter: Score-based              â”‚
     â”‚                              â”‚  Memory: 222 MiB                       â”‚
     â”‚                              â”‚  Checks: SPF, DKIM, DMARC, Bayes      â”‚
     â”‚                              â”‚  ClamAV: via clamd (1,021 MiB)         â”‚
     â”‚                              â”‚  Result: ACCEPT (score < threshold)    â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ DOVECOT (172.28.1.x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  LMTP delivery to mailbox              â”‚
     â”‚                              â”‚  Memory: 74.8 MiB                      â”‚
     â”‚                              â”‚  Storage: /var/vmail/                   â”‚
     â”‚                              â”‚  User: qui3tly@quietly.online          â”‚
     â”‚                              â”‚  Mailbox: INBOX                        â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”‚  4. SMTP 250 OK
     â”‚  â—€â”€â”€â”€â”€â”€â”€ 250 2.0.0 OK: Message queued

    ALL TRAFFIC ON: br-mailcow (172.28.1.0/24) â€” internal to Mailcow stack
    CONTAINERS INVOLVED: postfix â†’ rspamd â†’ clamd â†’ dovecot (+unbound for DNS)
    PUBLIC PORTS: 25 (SMTP), 465 (SMTPS), 587 (Submission), 993 (IMAPS)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SCENARIO 5: Mac â†’ Tailscale â†’ Master Monitoring Dashboard (Split-Horizon DNS)

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Mac Mini VPN access â†’ Split-horizon DNS â†’ Direct Tailscale
    Key: Same domain (grafana.quietly.its.me) resolves to DIFFERENT IPs
         based on DNS source (Pi-hole: VPN IP vs Cloudflare: Public IP)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Mac Mini â€” Home]                                 [MASTER â€” Control Plane]
â— en0: 192.168.99.x/24                            â— eth0: 213.136.68.108/24
â— utun (Tailscale): 100.64.0.3/32                 â— tailscale0: 100.64.0.1/32
     â”‚                                                  â”‚
     â”‚  1. DNS Query (split-horizon in action)          â”‚
     â”‚  Query: grafana.quietly.its.me                   â”‚
     â”‚  DNS server: 100.100.100.100 (MagicDNS)         â”‚
     â”‚  â†’ Headscale delegates to Pi-hole                â”‚
     â”‚  â†’ Pi-hole dnsmasq config:                       â”‚
     â”‚    address=/grafana.quietly.its.me/100.64.0.1    â”‚
     â”‚  Response: 100.64.0.1 (VPN IP â€” NOT public!)     â”‚
     â”‚                                                   â”‚
     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
     â”‚  â”‚ SPLIT-HORIZON COMPARISON:                   â”‚  â”‚
     â”‚  â”‚                                             â”‚  â”‚
     â”‚  â”‚ Query from VPN (Pi-hole):                   â”‚  â”‚
     â”‚  â”‚   grafana.quietly.its.me â†’ 100.64.0.1      â”‚  â”‚
     â”‚  â”‚   (Direct Tailscale â€” no public internet)   â”‚  â”‚
     â”‚  â”‚                                             â”‚  â”‚
     â”‚  â”‚ Query from Internet (Cloudflare):           â”‚  â”‚
     â”‚  â”‚   grafana.quietly.its.me â†’ 213.136.68.108   â”‚  â”‚
     â”‚  â”‚   (Public IP â€” goes through Traefik)        â”‚  â”‚
     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
     â”‚                                                   â”‚
     â”‚  2. HTTPS connection via Tailscale               â”‚
     â”‚  src: 100.64.0.3:rand                            â”‚
     â”‚  dst: 100.64.0.1:443                             â”‚
     â”‚  Transport: Tailscale mesh (direct peer)         â”‚
     â”‚  OUT: â— utun (Tailscale) â†’ â— en0 â†’ Internet     â”‚
     â”‚  Outer: UDP 41641 to 213.136.68.108:41641        â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
     â”‚                                                   â”‚
     â”‚                              â”Œâ”€ â— tailscale0 (Master) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  IP: 100.64.0.1/32                     â”‚
     â”‚                              â”‚  Decrypted: 100.64.0.3 â†’ 100.64.0.1   â”‚
     â”‚                              â”‚  dst port: 443                         â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ NETFILTER INPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  ts-input: src 100.64.0.0/10 â†’ ACCEPT â”‚
     â”‚                              â”‚  (Tailscale VPN traffic allowed)       â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                             â”‚
     â”‚                                             â–¼
     â”‚                              â”Œâ”€ DNAT â†’ Traefik (172.30.0.2:443) â”€â”€â”€â”€â”€â”
     â”‚                              â”‚  â†’ TLS termination                     â”‚
     â”‚                              â”‚  â†’ Host: grafana.quietly.its.me        â”‚
     â”‚                              â”‚  â†’ CrowdSec: PASS (VPN source)        â”‚
     â”‚                              â”‚  â†’ Authelia: Valid session? â†’ Yes      â”‚
     â”‚                              â”‚  â†’ Route to grafana (172.18.0.21)      â”‚
     â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    KEY INSIGHT: VPN users NEVER touch public IP. Traffic is encrypted
    end-to-end via Tailscale mesh. Split-horizon DNS ensures the
    shortest path is always used.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## SCENARIO 6: CrowdSec Alert â†’ Gotify Notification â†’ Phone

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    PACKET TRACE: Security event â†’ CrowdSec decision â†’ Gotify push
    Path: Attack detected â†’ CrowdSec â†’ bouncer blocks â†’ Gotify notifies
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[Attacker]                   [MASTER]                         [Phone/Client]
src: malicious IP            CrowdSec stack                   Gotify client
     â”‚                            â”‚                                â”‚
     â”‚  1. Brute force SSH         â”‚                                â”‚
     â”‚  Repeated auth failures     â”‚                                â”‚
     â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶      â”‚                                â”‚
     â”‚                            â”‚                                â”‚
     â”‚              â”Œâ”€ â— eth0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
     â”‚              â”‚  Incoming: SSH port 1006        â”‚            â”‚
     â”‚              â”‚  Fail2ban logs: auth failures   â”‚            â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
     â”‚                             â”‚                               â”‚
     â”‚                             â–¼                               â”‚
     â”‚              â”Œâ”€ CrowdSec Engine (172.18.0.3) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚              â”‚  Memory: 161.8 MiB                       â”‚   â”‚
     â”‚              â”‚  Action: Parse logs â†’ detect pattern     â”‚   â”‚
     â”‚              â”‚  Scenario: ssh-bruteforce                â”‚   â”‚
     â”‚              â”‚  Decision: BAN src IP for 4h             â”‚   â”‚
     â”‚              â”‚                                          â”‚   â”‚
     â”‚              â”‚  â†’ Push decision to Local API            â”‚   â”‚
     â”‚              â”‚  â†’ bouncer-traefik polls decisions       â”‚   â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                             â”‚                               â”‚
     â”‚                             â–¼                               â”‚
     â”‚              â”Œâ”€ bouncer-traefik (172.18.0.8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚              â”‚  Memory: 30.2 MiB                        â”‚   â”‚
     â”‚              â”‚  Action: Add IP to Traefik blocklist     â”‚   â”‚
     â”‚              â”‚  Effect: All future requests from this   â”‚   â”‚
     â”‚              â”‚          IP get HTTP 403 Forbidden        â”‚   â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                             â”‚                               â”‚
     â”‚                             â–¼                               â”‚
     â”‚              â”Œâ”€ Gotify (172.18.0.13) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
     â”‚              â”‚  Memory: 43.8 MiB                        â”‚   â”‚
     â”‚              â”‚  Notification: "CrowdSec: IP banned"     â”‚   â”‚
     â”‚              â”‚  Priority: High                          â”‚   â”‚
     â”‚              â”‚  Channel: Security                       â”‚   â”‚
     â”‚              â”‚  Push via WebSocket to connected clients â”‚â”€â”€â”€â–¶â”‚
     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
     â”‚                                                             â”‚
     â”‚                                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                    â”‚ ğŸ“± Pushâ”‚
     â”‚  ALL FUTURE REQUESTS:                              â”‚ Alert  â”‚
     â”‚  HTTP 403 Forbidden                                â”‚ Rcvd   â”‚
     â”‚  â—€â”€â”€â”€â”€â”€â”€ bouncer-traefik                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```
