graph TB
    subgraph Internet["üåê Internet"]
        MailClients[Email Clients<br/>Thunderbird, Outlook, Mobile]
        WebBrowsers[Web Browsers<br/>SOGo Webmail]
        Senders[Sending Mail Servers]
    end

    subgraph Mailcow["üìß MAILCOW STACK - Lady Server (18 containers)"]
        direction TB
        
        subgraph Frontend["Web Frontend"]
            Nginx[nginx<br/>‚Ä¢ Web UI<br/>‚Ä¢ TLS termination<br/>‚Ä¢ Reverse proxy<br/>Port: 443]
        end
        
        subgraph MailAccess["Mail Access"]
            Dovecot[Dovecot<br/>‚Ä¢ IMAP/IMAPS<br/>‚Ä¢ POP3/POP3S<br/>‚Ä¢ ManageSieve<br/>Port: 993, 995, 4190]
        end
        
        subgraph MailTransfer["Mail Transfer"]
            Postfix[Postfix<br/>‚Ä¢ SMTP MTA<br/>‚Ä¢ Submission<br/>‚Ä¢ TLS enforcement<br/>Port: 25, 465, 587]
        end
        
        subgraph Filtering["Spam & Virus Filtering"]
            Rspamd[Rspamd<br/>‚Ä¢ Spam detection<br/>‚Ä¢ DKIM signing<br/>‚Ä¢ Rate limiting<br/>‚Ä¢ Machine learning]
            ClamAV[ClamAV<br/>‚Ä¢ Virus scanning<br/>‚Ä¢ Real-time updates]
            Olefy[Olefy<br/>‚Ä¢ Office doc scanner<br/>‚Ä¢ Macro detection]
        end
        
        subgraph Webmail["Webmail & Groupware"]
            SOGo[SOGo<br/>‚Ä¢ Webmail UI<br/>‚Ä¢ Calendar (CalDAV)<br/>‚Ä¢ Contacts (CardDAV)<br/>‚Ä¢ ActiveSync]
        end
        
        subgraph Search["Search Engine"]
            Solr[Apache Solr<br/>‚Ä¢ Full-text search<br/>‚Ä¢ Mail indexing<br/>‚Ä¢ Fast queries]
        end
        
        subgraph Database["Data Storage"]
            MySQL[MySQL<br/>‚Ä¢ User accounts<br/>‚Ä¢ Mail metadata<br/>‚Ä¢ Settings]
            MailStorage[Mail Storage<br/>‚Ä¢ Maildir format<br/>‚Ä¢ /var/vmail/<br/>‚Ä¢ 73GB data]
        end
        
        subgraph Cache["Caching Layer"]
            Redis[Redis<br/>‚Ä¢ Session cache<br/>‚Ä¢ Rate limiting<br/>‚Ä¢ Temp data]
            Memcached[Memcached<br/>‚Ä¢ Object cache<br/>‚Ä¢ Performance]
        end
        
        subgraph DNS["DNS Resolution"]
            Unbound[Unbound<br/>‚Ä¢ Recursive DNS<br/>‚Ä¢ DNSSEC validation<br/>‚Ä¢ SPF/DKIM lookup]
        end
        
        subgraph Automation["Automation & Health"]
            Ofelia[Ofelia<br/>‚Ä¢ Cron scheduler<br/>‚Ä¢ Maintenance tasks<br/>‚Ä¢ Log rotation]
            Watchdog[Watchdog<br/>‚Ä¢ Container health<br/>‚Ä¢ Auto-restart<br/>‚Ä¢ Notifications]
        end
        
        subgraph Security["Security Layer"]
            DockerAPI[Docker API Proxy<br/>‚Ä¢ Socket protection<br/>‚Ä¢ Limited access]
            Netfilter[Netfilter<br/>‚Ä¢ Firewall rules<br/>‚Ä¢ Connection tracking<br/>‚Ä¢ Fail2ban integration]
            IPv6NAT[IPv6 NAT<br/>‚Ä¢ IPv6 support<br/>‚Ä¢ Address translation]
        end
        
        subgraph Certificates["TLS Certificates"]
            ACME[ACME<br/>‚Ä¢ Let's Encrypt<br/>‚Ä¢ Auto-renewal<br/>‚Ä¢ Multi-domain]
        end
    end

    subgraph External["üîó External Services"]
        DNS_Servers[DNS Servers<br/>‚Ä¢ MX records<br/>‚Ä¢ SPF, DKIM, DMARC<br/>‚Ä¢ MTA-STS]
        LE[Let's Encrypt<br/>ACME CA]
    end

    MailClients -->|IMAP/POP3| Dovecot
    WebBrowsers -->|HTTPS| Nginx
    Senders -->|SMTP| Postfix
    
    Nginx --> SOGo
    
    Postfix --> Rspamd
    Rspamd --> ClamAV
    Rspamd --> Olefy
    Rspamd --> Dovecot
    Dovecot --> MailStorage
    
    Dovecot --> Solr
    SOGo --> Dovecot
    SOGo --> MySQL
    SOGo --> Memcached
    
    Postfix --> MySQL
    Dovecot --> MySQL
    Rspamd --> Redis
    
    Postfix --> Unbound
    Rspamd --> Unbound
    Unbound --> DNS_Servers
    
    Ofelia -.->|Schedules| Watchdog
    Watchdog -.->|Monitors| Postfix
    Watchdog -.->|Monitors| Dovecot
    Watchdog -.->|Monitors| SOGo
    
    DockerAPI -.->|Protects| Watchdog
    Netfilter -.->|Filters| Postfix
    Netfilter -.->|Filters| Dovecot
    
    ACME -->|Requests| LE
    ACME -.->|Provides certs| Nginx
    ACME -.->|Provides certs| Postfix
    ACME -.->|Provides certs| Dovecot

    subgraph Stats["üìä Statistics (Last 7 Days)"]
        S1[Total Messages: 3,842]
        S2[Spam Detected: 234 - 6.1%]
        S3[Ham: 3,608 - 93.9%]
        S4[Viruses: 0]
        S5[False Positives: 2]
    end

    classDef frontend fill:#326ce5,stroke:#fff,stroke-width:2px,color:#fff
    classDef mail fill:#00d4aa,stroke:#fff,stroke-width:2px,color:#000
    classDef security fill:#d62828,stroke:#fff,stroke-width:2px,color:#fff
    classDef data fill:#f77f00,stroke:#fff,stroke-width:2px,color:#fff

    class Nginx,Frontend frontend
    class Postfix,Dovecot,Rspamd,ClamAV mail
    class Netfilter,DockerAPI,ACME security
    class MySQL,Redis,MailStorage data
