]633;E;{   echo "# backup script listing"\x3b ls -la ~/.copilot/cron/\x3b   echo\x3b echo "# docker_backup.sh"\x3b sed -n '1,260p' ~/.copilot/cron/docker_backup.sh\x3b } > /home/qui3tly/projects/qui3tly.cloud/PHASE-00-FOUNDATION/AGENT3/EVIDENCE/backup_script_listing.txt 2>&1;cb80ee7f-9768-4bcb-9d38-2f473ba6c305]633;C# backup script listing
total 28
drwxr-xr-x  2 qui3tly qui3tly 4096 Feb 10 03:08 .
drwxr-xr-x 10 qui3tly qui3tly 4096 Feb  3 14:47 ..
-rwxr-xr-x  1 qui3tly qui3tly 2043 Jan 10 22:25 daily_report.sh
-rwxr-xr-x  1 qui3tly qui3tly 1256 Feb 15 20:17 docker_backup.sh
-rwxr-xr-x  1 qui3tly qui3tly 6189 Jan 10 22:27 monthly_report.sh
-rwxr-xr-x  1 qui3tly qui3tly 3989 Jan 10 22:27 weekly_security.sh

# docker_backup.sh
#!/bin/bash
# Docker Volume Backup Script
# Created: 2026-02-10

BACKUP_DIR="/home/qui3tly/backups"
DATE=$(date +%Y%m%d_%H%M%S)
LOG_FILE="$BACKUP_DIR/backup_$DATE.log"

mkdir -p "$BACKUP_DIR"

echo "=== Docker Backup Started: $(date) ===" > "$LOG_FILE"

# Backup critical docker volumes
# FIXED 2026-02-15: Using correct volume names (Agent 2 audit finding)
VOLUMES=(
    "portainer_portainer_data"
    "monitoring_grafana_data"
    "monitoring_prometheus_data"
    "monitoring_loki_data"
    "grafana_grafana_data"
    "prometheus_prometheus_data"
    "loki_loki_data"
)

for vol in "${VOLUMES[@]}"; do
    echo "Backing up $vol..." >> "$LOG_FILE"
    docker run --rm -v "$vol":/source -v "$BACKUP_DIR":/backup alpine \
        tar -czf "/backup/${vol}_$DATE.tar.gz" -C /source . 2>> "$LOG_FILE" || \
        echo "  FAILED: $vol" >> "$LOG_FILE"
done

# Backup compose files
tar -czf "$BACKUP_DIR/compose_$DATE.tar.gz" -C /home/qui3tly .docker-compose 2>> "$LOG_FILE"

# Backup secrets (encrypted)
tar -czf "$BACKUP_DIR/secrets_$DATE.tar.gz" -C /home/qui3tly .secrets 2>> "$LOG_FILE"

# Cleanup old backups (keep 7 days)
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +7 -delete 2>> "$LOG_FILE"

echo "=== Docker Backup Completed: $(date) ===" >> "$LOG_FILE"
