]633;E;{   echo "# backup script full content"\x3b sed -n '1,320p' ~/.copilot/cron/docker_backup.sh\x3b } > /home/qui3tly/projects/qui3tly.cloud/PHASE-00-FOUNDATION/AGENT3/EVIDENCE/docker_backup_script_content.txt 2>&1;cb80ee7f-9768-4bcb-9d38-2f473ba6c305]633;C# backup script full content
#!/bin/bash
# Docker Volume Backup Script
# Created: 2026-02-10

BACKUP_DIR="/home/qui3tly/backups"
DATE=$(date +%Y%m%d_%H%M%S)
LOG_FILE="$BACKUP_DIR/backup_$DATE.log"

mkdir -p "$BACKUP_DIR"

echo "=== Docker Backup Started: $(date) ===" > "$LOG_FILE"

# Backup critical docker volumes
# FIXED 2026-02-15: Using correct volume names (Agent 2 audit finding)
VOLUMES=(
    "portainer_portainer_data"
    "monitoring_grafana_data"
    "monitoring_prometheus_data"
    "monitoring_loki_data"
    "grafana_grafana_data"
    "prometheus_prometheus_data"
    "loki_loki_data"
)

for vol in "${VOLUMES[@]}"; do
    echo "Backing up $vol..." >> "$LOG_FILE"
    docker run --rm -v "$vol":/source -v "$BACKUP_DIR":/backup alpine \
        tar -czf "/backup/${vol}_$DATE.tar.gz" -C /source . 2>> "$LOG_FILE" || \
        echo "  FAILED: $vol" >> "$LOG_FILE"
done

# Backup compose files
tar -czf "$BACKUP_DIR/compose_$DATE.tar.gz" -C /home/qui3tly .docker-compose 2>> "$LOG_FILE"

# Backup secrets (encrypted)
tar -czf "$BACKUP_DIR/secrets_$DATE.tar.gz" -C /home/qui3tly .secrets 2>> "$LOG_FILE"

# Cleanup old backups (keep 7 days)
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +7 -delete 2>> "$LOG_FILE"

echo "=== Docker Backup Completed: $(date) ===" >> "$LOG_FILE"
